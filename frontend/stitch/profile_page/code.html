<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>CareerLens AI - My Profile</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3caff6",
                        "background-dark": "#0b0e14",
                        "surface-dark": "#161d26",
                        "accent-green": "#10b981",
                        "accent-red": "#ef4444",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    }
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            scrollbar-gutter: stable;
        }

        .glass-card {
            background: rgba(22, 29, 38, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(60, 175, 246, 0.1);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3caff622;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #3caff644;
        }
    </style>
</head>

<body class="bg-background-dark text-white min-h-screen flex flex-col font-display overflow-x-hidden">
    <!-- Header -->
    <header
        class="flex items-center justify-between p-4 md:px-8 border-b border-primary/10 bg-background-dark/50 sticky top-0 z-50 backdrop-blur-md">
        <div class="flex items-center gap-4">
            <a href="../landing_page/code.html" class="flex items-center gap-2">
                <div class="bg-primary p-1.5 rounded-lg">
                    <span class="material-symbols-outlined text-white text-2xl">insights</span>
                </div>
                <h2 class="text-xl font-bold tracking-tight text-white">CareerLens AI</h2>
            </a>
        </div>
        <div class="flex items-center gap-4">
            <a href="../dashboard/code.html"
                class="text-slate-400 hover:text-white transition-colors text-sm font-medium hidden md:block">Results</a>
            <div class="size-8 rounded-full bg-primary/20 border border-primary/30 flex items-center justify-center overflow-hidden"
                id="headerAvatarContainer">
                <span class="material-symbols-outlined text-primary text-sm">person</span>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-2xl mx-auto w-full p-6 md:p-10 pb-28 md:pb-10 space-y-8">
        <!-- Profile Header/Hero -->
        <div
            class="flex flex-col items-center text-center p-8 bg-surface-dark border border-slate-800 rounded-3xl relative overflow-hidden">
            <div class="absolute -right-10 -top-10 size-40 bg-primary/10 rounded-full blur-3xl"></div>

            <div class="relative mb-4 group">
                <div id="profileAvatar"
                    class="size-28 rounded-full bg-primary/20 border-4 border-background-dark shadow-2xl flex items-center justify-center overflow-hidden relative">
                    <span class="material-symbols-outlined text-4xl text-primary">person</span>
                </div>
                <label for="avatarUpload"
                    class="absolute bottom-0 right-1 size-9 bg-primary text-background-dark rounded-full flex items-center justify-center cursor-pointer shadow-lg hover:scale-110 transition-transform border-4 border-surface-dark">
                    <span class="material-symbols-outlined text-base">photo_camera</span>
                </label>
                <input type="file" id="avatarUpload" class="hidden" accept="image/*">
            </div>

            <h1 id="profileName" class="text-3xl font-bold">Hazique Qureshi</h1>
            <div class="flex items-center justify-center gap-2 mt-2">
                <span id="profileLevel"
                    class="px-3 py-1 bg-accent-green/10 text-accent-green border border-accent-green/20 rounded-full text-[10px] font-black uppercase tracking-wider">Lvl
                    4 Professional</span>
                <span id="profileRole" class="text-sm text-slate-400 italic">Career Explorer</span>
            </div>

            <button onclick="openEditProfile()"
                class="mt-4 px-6 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-bold rounded-xl border border-slate-700 transition-all flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">settings</span>
                Manage Identity
            </button>
        </div>

        <!-- Career Statistics -->
        <div class="grid grid-cols-3 gap-4">
            <div class="bg-surface-dark p-5 rounded-3xl border border-slate-800 text-center relative overflow-hidden">
                <div class="absolute -left-4 -top-4 size-12 bg-primary/5 rounded-full blur-xl"></div>
                <p class="text-2xl font-black text-primary" id="statAnalyses">0</p>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">Analyses</p>
            </div>
            <div class="bg-surface-dark p-5 rounded-3xl border border-slate-800 text-center relative overflow-hidden">
                <div class="absolute -left-4 -top-4 size-12 bg-accent-green/5 rounded-full blur-xl"></div>
                <p class="text-2xl font-black text-accent-green" id="statInterviews">0</p>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">Simulations</p>
            </div>
            <div class="bg-surface-dark p-5 rounded-3xl border border-slate-800 text-center relative overflow-hidden">
                <div class="absolute -left-4 -top-4 size-12 bg-amber-500/5 rounded-full blur-xl"></div>
                <p class="text-2xl font-black text-amber-500" id="statProgress">0%</p>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-1">Roadmap</p>
            </div>
        </div>

        <!-- Account Settings / Goals -->
        <div class="space-y-4">
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest pl-2">Preferences & Stability</h3>
            <div class="glass-card rounded-3xl divide-y divide-slate-800">
                <div class="p-6 flex items-center justify-between">
                    <div>
                        <p class="text-xs font-bold text-slate-500 uppercase mb-1">Target Compensation</p>
                        <select id="salaryTarget"
                            class="bg-transparent border-none text-white text-sm focus:ring-0 cursor-pointer p-0 font-medium">
                            <option value="entry" class="bg-surface-dark">$40k - $70k</option>
                            <option value="mid" class="bg-surface-dark">$70k - $120k</option>
                            <option value="senior" class="bg-surface-dark" selected>$120k - $200k+</option>
                        </select>
                    </div>
                    <span class="material-symbols-outlined text-slate-600">payments</span>
                </div>

                <button onclick="window.location.href='../interview_history/code.html'"
                    class="w-full p-6 flex items-center justify-between hover:bg-white/5 transition-colors group">
                    <div class="flex items-center gap-4">
                        <div class="size-10 bg-emerald-500/10 rounded-xl flex items-center justify-center">
                            <span class="material-symbols-outlined text-emerald-500 text-xl">history_edu</span>
                        </div>
                        <div class="text-left">
                            <p class="text-sm font-bold">Interview Transcripts</p>
                            <p class="text-[10px] text-slate-500 font-medium">Review your AI-generated feedback</p>
                        </div>
                    </div>
                    <span
                        class="material-symbols-outlined text-slate-600 group-hover:text-white transition-colors">chevron_right</span>
                </button>

                <button id="logoutBtn"
                    class="w-full p-6 flex items-center justify-between hover:bg-red-500/5 transition-colors group">
                    <div class="flex items-center gap-4">
                        <div class="size-10 bg-red-500/10 rounded-xl flex items-center justify-center">
                            <span class="material-symbols-outlined text-red-500 text-xl">logout</span>
                        </div>
                        <div class="text-left">
                            <p class="text-sm font-bold text-red-500">Secure Logout</p>
                            <p class="text-[10px] text-slate-500 font-medium">Ends your current session</p>
                        </div>
                    </div>
                    <span
                        class="material-symbols-outlined text-slate-600 group-hover:text-red-500 transition-colors">chevron_right</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Bottom Nav -->
    <nav
        class="bg-background-dark/80 backdrop-blur-md border-t border-slate-800 px-4 pb-6 pt-3 md:hidden fixed bottom-0 left-0 right-0 z-50">
        <div class="flex gap-2 max-w-md mx-auto">
            <a class="flex flex-1 flex-col items-center justify-center gap-1.5 rounded-2xl py-2 text-slate-500 hover:bg-white/5 transition-colors"
                href="../upload_page/code.html">
                <span class="material-symbols-outlined text-xl">upload</span>
                <p class="text-[9px] font-black uppercase tracking-widest">Upload</p>
            </a>
            <a class="flex flex-1 flex-col items-center justify-center gap-1.5 rounded-2xl py-2 text-slate-500 hover:bg-white/5 transition-colors"
                href="../dashboard/code.html">
                <span class="material-symbols-outlined text-xl">analytics</span>
                <p class="text-[9px] font-black uppercase tracking-widest">Results</p>
            </a>
            <a class="flex flex-1 flex-col items-center justify-center gap-1.5 rounded-2xl py-2 text-primary bg-primary/10 border border-primary/20"
                href="../profile_page/code.html">
                <span class="material-symbols-outlined text-xl" style="font-variation-settings: 'FILL' 1">person</span>
                <p class="text-[9px] font-black uppercase tracking-widest">Profile</p>
            </a>
        </div>
    </nav>

    <!-- AI Chatbot FAB -->
    <div id="aiChatbot" class="fixed bottom-24 right-6 z-[100] md:bottom-8 group">
        <button id="chatbotFab"
            class="size-14 rounded-2xl bg-primary text-background-dark shadow-2xl flex items-center justify-center hover:scale-110 hover:rotate-6 transition-all active:scale-95 relative shadow-primary/20 overflow-hidden">
            <div class="absolute inset-0 bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
            <span class="material-symbols-outlined text-2xl font-black">smart_toy</span>
        </button>
        <div id="chatbotWindow"
            class="absolute bottom-16 right-0 w-80 sm:w-96 h-[500px] bg-surface-dark border border-white/10 rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex flex-col hidden overflow-hidden animate-in slide-in-from-bottom-5 duration-300">
            <div class="p-5 border-b border-white/5 flex items-center justify-between bg-primary/5">
                <div class="flex items-center gap-3">
                    <div class="size-9 rounded-xl bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-sm font-black">psychology</span>
                    </div>
                    <div>
                        <h4 class="font-black text-xs text-white uppercase tracking-widest">Career Advisor</h4>
                        <div class="flex items-center gap-1.5 mt-0.5">
                            <span
                                class="size-1.5 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.5)]"></span>
                            <span class="text-[9px] font-bold text-slate-500 uppercase">System Active</span>
                        </div>
                    </div>
                </div>
                <button id="closeChat" class="p-2 hover:bg-white/5 rounded-xl transition-colors text-slate-500">
                    <span class="material-symbols-outlined text-sm">close</span>
                </button>
            </div>
            <div id="chatMessages" class="flex-1 overflow-y-auto p-5 space-y-4 scroll-smooth custom-scrollbar">
                <div class="flex gap-3 max-w-[85%]">
                    <div class="size-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0">
                        <span class="material-symbols-outlined text-primary text-xs">robot</span>
                    </div>
                    <div
                        class="bg-white/5 border border-white/5 p-4 rounded-2xl rounded-tl-none text-xs leading-relaxed text-slate-300">
                        Profile optimized. Ready to discuss your trajectory or roadmap progress. What's on your mind?
                    </div>
                </div>
            </div>

            <!-- Suggested Prompts -->
            <div id="chatbotSuggestions"
                class="px-5 py-2 flex gap-2 overflow-x-auto no-scrollbar border-t border-white/5 bg-white/5">
                <!-- Suggestions injected by JS -->
            </div>

            <div class="p-5 bg-background-dark/80 backdrop-blur-sm border-t border-white/5">
                <form id="chatForm" class="relative group">
                    <input type="text" id="chatInput" placeholder="Ask about career goals..."
                        class="w-full bg-white/5 border border-white/10 rounded-2xl pl-5 pr-12 py-3.5 text-xs text-white focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all placeholder:text-slate-700">
                    <button type="submit"
                        class="absolute right-2 top-1.5 size-10 bg-primary text-background-dark rounded-xl flex items-center justify-center hover:scale-105 transition-all shadow-lg active:scale-95">
                        <span class="material-symbols-outlined text-sm font-black">send</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
    <script src="../chatbot.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) {
                window.location.href = '../landing_page/code.html';
                return;
            }

            initProfile();
        });

        function initProfile() {
            const userProfile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            const analysisHistory = JSON.parse(localStorage.getItem('careerAnalysisHistory') || '[]');
            const interviewHistory = JSON.parse(localStorage.getItem('interviewSessionHistory') || '[]');

            // Update Header & Profile Info
            if (userProfile.name) {
                document.getElementById('profileName').textContent = userProfile.name;
            }
            if (userProfile.avatar) {
                renderAvatar(userProfile.avatar);
            }

            // Update Current Role
            if (analysisHistory.length > 0) {
                document.getElementById('profileRole').textContent = analysisHistory[0].target_role || "Career Explorer";
            }

            // Update Core Stats
            document.getElementById('statAnalyses').textContent = analysisHistory.length;
            document.getElementById('statInterviews').textContent = interviewHistory.length;

            // Calculate Roadmap Progress
            let completedSteps = 0;
            for (let i = 0; i < 50; i++) { // Wide range check
                if (localStorage.getItem(`step-${i}`) === 'true') completedSteps++;
            }
            const progress = analysisHistory.length > 0 ? Math.min(100, Math.round((completedSteps / 5) * 100)) : 0;
            document.getElementById('statProgress').textContent = progress + '%';

            // Leveling Logic
            const levels = ["Initiate", "Novice", "Apprentice", "Professional", "Expert", "Elite"];
            const levelIndex = Math.min(levels.length - 1, Math.floor(progress / 20));
            document.getElementById('profileLevel').textContent = `Lvl ${levelIndex + 1} ${levels[levelIndex]}`;

            // Logout Listener
            document.getElementById('logoutBtn').addEventListener('click', () => {
                Swal.fire({
                    title: 'End Session?',
                    text: "You will need to login again to access your analysis.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3caff6',
                    cancelButtonColor: '#ef4444',
                    background: '#161d26',
                    color: '#fff',
                    confirmButtonText: 'Logout',
                    cancelButtonText: 'Cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        localStorage.removeItem('isLoggedIn');
                        window.location.href = '../landing_page/code.html';
                    }
                });
            });

            // Avatar Upload Support
            document.getElementById('avatarUpload').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (re) => {
                        const base64 = re.target.result;
                        renderAvatar(base64);
                        const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
                        profile.avatar = base64;
                        localStorage.setItem('userProfile', JSON.stringify(profile));
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function renderAvatar(src) {
            const avatarEls = [
                document.getElementById('profileAvatar'),
                document.getElementById('headerAvatarContainer')
            ];
            avatarEls.forEach(el => {
                if (el) {
                    el.innerHTML = `<img src="${src}" class="size-full object-cover">`;
                }
            });
        }

        async function openEditProfile() {
            const profile = JSON.parse(localStorage.getItem('userProfile')) || {
                name: "New Explorer",
                email: "email@example.com",
                avatar: ""
            };

            const avatarPresets = [
                'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix',
                'https://api.dicebear.com/7.x/avataaars/svg?seed=Luna',
                'https://api.dicebear.com/7.x/avataaars/svg?seed=Jack',
                'https://api.dicebear.com/7.x/avataaars/svg?seed=Milo',
                'https://api.dicebear.com/7.x/avataaars/svg?seed=Zoe'
            ];

            const { value: formValues } = await Swal.fire({
                title: 'Manage Identity',
                background: '#161d26',
                color: '#fff',
                confirmButtonColor: '#3caff6',
                html: `
                    <div class="space-y-4 text-left p-2">
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest pl-1">Display Name</label>
                            <input id="swal-name" class="w-full bg-[#0b0e14] border border-slate-700 rounded-xl p-4 text-sm focus:border-primary outline-none mt-1" value="${profile.name}">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest pl-1">Email Address</label>
                            <input id="swal-email" class="w-full bg-[#0b0e14] border border-slate-700 rounded-xl p-4 text-sm focus:border-primary outline-none mt-1" value="${profile.email}">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest pl-1">Avatar Preset</label>
                            <div class="flex gap-4 mt-2 overflow-x-auto pb-2 custom-scrollbar">
                                ${avatarPresets.map(url => `
                                    <div class="preset-opt size-12 rounded-full cursor-pointer border-2 ${profile.avatar === url ? 'border-primary' : 'border-slate-800'} hover:border-primary/50 transition-all overflow-hidden shrink-0" 
                                         onclick="window.selectedAvatar='${url}'; document.querySelectorAll('.preset-opt').forEach(el=>el.classList.replace('border-primary','border-slate-800')); this.classList.replace('border-slate-800','border-primary')">
                                        <img src="${url}" class="size-full">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `,
                preConfirm: () => {
                    return {
                        name: document.getElementById('swal-name').value,
                        email: document.getElementById('swal-email').value,
                        avatar: window.selectedAvatar || profile.avatar
                    }
                }
            });

            if (formValues) {
                localStorage.setItem('userProfile', JSON.stringify(formValues));
                initProfile();
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: 'success',
                    title: 'Identity Updated',
                    showConfirmButton: false,
                    timer: 1500,
                    background: '#161d26',
                    color: '#fff'
                });
            }
        }

    </script>
</body>

</html>