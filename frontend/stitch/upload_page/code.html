<!DOCTYPE html>

<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>CareerLens AI - Upload Resume</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#3caff6",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101b22",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
        }

        .glass-card {
            background: rgba(27, 35, 39, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(60, 175, 246, 0.1);
        }

        .upload-dashed {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%233CAFF666' stroke-width='2' stroke-dasharray='8%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen flex flex-col font-display">
    <!-- Top Navigation / Header -->
    <header
        class="flex items-center justify-between p-4 md:px-8 border-b border-primary/10 bg-background-dark/50 sticky top-0 z-50">
        <a href="../landing_page/code.html" class="flex items-center gap-2">
            <div class="bg-primary p-1.5 rounded-lg">
                <span class="material-symbols-outlined text-white text-2xl">insights</span>
            </div>
            <h2 class="text-xl font-bold tracking-tight text-white">CareerLens <span
                    class="text-primary text-sm font-medium">AI</span></h2>
            <div
                class="ml-4 px-2 py-0.5 bg-primary/20 rounded border border-primary/30 text-[10px] uppercase font-bold text-primary">
                Step 3 of 4</div>
        </a>
        <div class="flex items-center gap-4">
            <button class="text-slate-400 hover:text-white transition-colors">
                <span class="material-symbols-outlined">help_outline</span>
            </button>
            <a href="../profile_page/code.html"
                class="size-8 rounded-full bg-primary/20 border border-primary/30 flex items-center justify-center hover:bg-primary transition-colors group">
                <span
                    class="material-symbols-outlined text-primary text-sm group-hover:text-background-dark">person</span>
            </a>
        </div>
    </header>
    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col items-center justify-center p-4 md:p-8">
        <div class="w-full max-w-xl">
            <!-- Centered Card -->
            <div class="glass-card rounded-xl p-6 md:p-10 shadow-2xl relative overflow-hidden">
                <!-- Abstract Glow Decoration -->
                <div class="absolute -top-24 -right-24 size-48 bg-primary/10 rounded-full blur-3xl"></div>
                <div class="absolute -bottom-24 -left-24 size-48 bg-primary/5 rounded-full blur-3xl"></div>
                <div class="relative z-10">
                    <div class="text-center mb-10">
                        <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">Upload Your Resume</h1>
                        <p class="text-slate-400 text-base">Step 3 of 4: Select your target role and let AI map your
                            potential.</p>
                    </div>
                    <form class="space-y-8" id="uploadForm">
                        <!-- Drag & Drop Area -->
                        <div class="group relative">
                            <div class="upload-dashed rounded-xl p-10 flex flex-col items-center justify-center transition-all group-hover:bg-primary/5 cursor-pointer"
                                id="dropZone">
                                <div
                                    class="size-16 rounded-full bg-primary/10 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <span class="material-symbols-outlined text-primary text-3xl">upload_file</span>
                                </div>
                                <h3 class="text-lg font-medium text-white mb-1" id="fileNameDisplay">Drag &amp; Drop PDF
                                </h3>
                                <p class="text-sm text-slate-400 text-center">Drop your resume here or <span
                                        class="text-primary font-semibold">browse files</span></p>
                                <input accept=".pdf" class="absolute inset-0 opacity-0 cursor-pointer" id="resumeFile"
                                    name="resume" required="" type="file" />
                            </div>
                        </div>
                        <!-- Role Selection -->
                        <div class="space-y-3">
                            <label class="text-sm font-medium text-slate-300 ml-1">What role are you aiming for?</label>
                            <div class="relative">
                                <span
                                    class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">work</span>
                                <select
                                    class="w-full bg-[#283239]/50 border border-slate-700 rounded-lg py-3.5 pl-12 pr-10 text-white appearance-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                                    id="targetRole" name="target_role" required="">
                                    <option disabled="" selected="" value="">Select a target role</option>
                                    <option value="data-scientist">Data Scientist</option>
                                    <option value="frontend">Frontend Developer</option>
                                    <option value="ux-designer">UX Designer</option>
                                    <option value="product-manager">Product Manager</option>
                                    <option value="backend">Backend Engineer</option>
                                    <option value="mobile">Mobile Developer</option>
                                    <option value="devops">DevOps Engineer</option>
                                    <option value="fullstack">Fullstack Developer</option>
                                    <option value="security">Cybersecurity Analyst</option>
                                    <option value="ai-ml">AI/ML Engineer</option>
                                    <option value="data-analyst">Data Analyst</option>
                                    <option value="cloud-architect">Cloud Architect</option>
                                    <option value="qa-engineer">QA Engineer</option>
                                    <option value="embedded">Embedded Systems Engineer</option>
                                </select>
                                <span
                                    class="material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none">expand_more</span>
                            </div>
                        </div>
                        <!-- Primary Button -->
                        <div class="space-y-4">
                            <div id="progressContainer" class="hidden space-y-2">
                                <div
                                    class="flex justify-between text-xs font-bold text-primary uppercase tracking-widest">
                                    <span>AI Processing</span>
                                    <span id="progressText">0%</span>
                                </div>
                                <div
                                    class="w-full bg-slate-800 h-2 rounded-full overflow-hidden border border-slate-700">
                                    <div id="progressBar" class="bg-primary h-full w-0 transition-all duration-300">
                                    </div>
                                </div>
                            </div>

                            <button
                                class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-lg shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2 group"
                                id="submitBtn" type="submit">
                                <span id="btnText">Analyze Career Fit</span>
                                <span
                                    class="material-symbols-outlined text-xl group-hover:translate-x-1 transition-transform"
                                    id="btnIcon">bolt</span>
                            </button>
                        </div>
                    </form>

                    <!-- Toast Notification -->
                    <div id="toast"
                        class="fixed top-24 left-1/2 -translate-x-1/2 z-[100] flex items-center gap-3 px-6 py-3 rounded-xl shadow-2xl transition-all duration-300 translate-y-[-200%] opacity-0">
                        <span id="toastIcon" class="material-symbols-outlined">info</span>
                        <p id="toastMsg" class="text-sm font-bold"></p>
                    </div>

                    <script>
                        // Session Protection
                        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                        if (!isLoggedIn) {
                            window.location.href = '../landing_page/code.html';
                        }

                        const uploadForm = document.getElementById('uploadForm');
                        const resumeFileInput = document.getElementById('resumeFile');
                        const fileNameDisplay = document.getElementById('fileNameDisplay');

                        // Load User Profile
                        const userProfile = JSON.parse(localStorage.getItem('userProfile'));
                        if (userProfile && userProfile.avatar) {
                            const profileContainer = document.querySelector('a[href="../profile_page/code.html"]');
                            if (profileContainer) {
                                profileContainer.innerHTML = `<img src="${userProfile.avatar}" class="size-full rounded-full border border-primary/30 object-cover" alt="Profile">`;
                            }
                        }
                        const submitBtn = document.getElementById('submitBtn');
                        const btnText = document.getElementById('btnText');
                        const btnIcon = document.getElementById('btnIcon');

                        resumeFileInput.addEventListener('change', (e) => {
                            if (e.target.files.length > 0) {
                                fileNameDisplay.textContent = e.target.files[0].name;
                                fileNameDisplay.classList.add('text-primary');
                            }
                        });

                        uploadForm.addEventListener('submit', async (e) => {
                            e.preventDefault();

                            const file = resumeFileInput.files[0];
                            const role = document.getElementById('targetRole').value;

                            if (!file) {
                                showToast('Please upload a resume PDF.', 'error');
                                return;
                            }
                            if (!role) {
                                showToast('Please select a target role.', 'error');
                                return;
                            }

                            // Loading State
                            submitBtn.disabled = true;
                            submitBtn.classList.replace('bg-primary', 'bg-slate-700');
                            btnText.textContent = "Processing...";
                            btnIcon.textContent = "hourglass_empty";
                            btnIcon.classList.add('animate-spin');

                            const progressContainer = document.getElementById('progressContainer');
                            const progressBar = document.getElementById('progressBar');
                            const progressText = document.getElementById('progressText');
                            progressContainer.classList.remove('hidden');

                            // Simulated Progress
                            let progress = 0;
                            const interval = setInterval(() => {
                                if (progress < 90) {
                                    progress += Math.random() * 15;
                                    if (progress > 90) progress = 90;
                                    progressBar.style.width = `${progress}%`;
                                    progressText.textContent = `${Math.round(progress)}%`;
                                }
                            }, 400);

                            const formData = new FormData();
                            formData.append('resume', file);
                            formData.append('target_role', role);

                            function showToast(msg, type = 'success') {
                                const toast = document.getElementById('toast');
                                const icon = document.getElementById('toastIcon');
                                const text = document.getElementById('toastMsg');

                                toast.classList.remove('bg-emerald-500', 'bg-red-500', 'text-white');
                                if (type === 'success') {
                                    toast.classList.add('bg-emerald-500', 'text-white');
                                    icon.textContent = 'check_circle';
                                } else {
                                    toast.classList.add('bg-red-500', 'text-white');
                                    icon.textContent = 'error';
                                }

                                text.textContent = msg;
                                toast.classList.remove('translate-y-[-200%]', 'opacity-0');

                                setTimeout(() => {
                                    toast.classList.add('translate-y-[-200%]', 'opacity-0');
                                }, 3000);
                            }

                            try {
                                // Dynamic API URL to support both localhost and LAN
                                const apiHost = window.location.hostname || '127.0.0.1';
                                const response = await fetch(`http://${apiHost}:9000/api/analyze`, {
                                    method: 'POST',
                                    body: formData
                                });

                                if (!response.ok) throw new Error('Backend error');

                                const data = await response.json();

                                // Complete progress
                                clearInterval(interval);
                                progressBar.style.width = '100%';
                                progressText.textContent = '100%';

                                showToast('Analysis Complete! Personalizing your roadmap...');

                                // Save to localStorage
                                localStorage.setItem('careerAnalysis', JSON.stringify(data));

                                // Redirect to dashboard after a short delay
                                setTimeout(() => {
                                    window.location.href = '../dashboard/code.html';
                                }, 1500);

                            } catch (error) {
                                clearInterval(interval);
                                console.error('Error:', error);
                                showToast('Connection Error. Checking backend...', 'error');

                                // Reset state
                                submitBtn.disabled = false;
                                submitBtn.classList.replace('bg-slate-700', 'bg-primary');
                                btnText.textContent = "Analyze Career Fit";
                                btnIcon.textContent = "bolt";
                                btnIcon.classList.remove('animate-spin');
                                progressContainer.classList.add('hidden');
                            }
                        });
                    </script>
                    <div
                        class="mt-8 pt-6 border-t border-slate-800 flex items-center justify-between text-[11px] uppercase tracking-widest text-slate-500 font-semibold">
                        <span>Max File Size: 5MB</span>
                        <span class="flex items-center gap-1"><span
                                class="material-symbols-outlined text-sm">lock</span> Secure Analysis</span>
                        <span>Format: PDF</span>
                    </div>
                </div>
            </div>
            <!-- Hint Text below card -->
            <p class="text-center mt-6 text-slate-500 text-sm">
                By uploading, you agree to our <a class="underline hover:text-slate-300" href="#">Terms of Service</a>.
            </p>
        </div>
    </main>
    <!-- Bottom Navigation Bar (Modified from component list) -->
    <nav class="bg-background-dark border-t border-slate-800 px-4 pb-4 pt-2 md:hidden">
        <div class="flex gap-2 max-w-md mx-auto">
            <a class="flex flex-1 flex-col items-center justify-end gap-1 rounded-lg py-2 text-primary"
                href="../upload_page/code.html">
                <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1">upload</span>
                <p class="text-xs font-medium leading-normal tracking-wide">Upload</p>
            </a>
            <a class="flex flex-1 flex-col items-center justify-end gap-1 rounded-lg py-2 text-slate-500"
                href="../dashboard/code.html">
                <span class="material-symbols-outlined">history</span>
                <p class="text-xs font-medium leading-normal tracking-wide">Results</p>
            </a>
            <a class="flex flex-1 flex-col items-center justify-end gap-1 rounded-lg py-2 text-slate-500"
                href="../profile_page/code.html">
                <span class="material-symbols-outlined">person</span>
                <p class="text-xs font-medium leading-normal tracking-wide">Profile</p>
            </a>
        </div>
    </nav>
    <!-- Desktop Sidebar/Footer hint (Hidden on mobile) -->
    <footer class="hidden md:flex items-center justify-center p-6 bg-background-dark/30 border-t border-primary/5">
        <div class="flex gap-8 text-slate-500 text-sm">
            <a class="hover:text-primary transition-colors flex items-center gap-1" href="#"><span
                    class="material-symbols-outlined text-lg">description</span> View Sample</a>
            <a class="hover:text-primary transition-colors flex items-center gap-1" href="#"><span
                    class="material-symbols-outlined text-lg">shield</span> Privacy Policy</a>
            <a class="hover:text-primary transition-colors flex items-center gap-1" href="#"><span
                    class="material-symbols-outlined text-lg">contact_support</span> Support</a>
        </div>
    </footer>
</body>

</html>